/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

package proyectoclinicadental;

import com.sun.glass.events.KeyEvent;
import java.sql.ResultSet;
import java.sql.SQLException;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JOptionPane;

/**
 *
 * @author Javier
 */
public class frmFacturacion extends javax.swing.JFrame {

    /** Creates new form frmFacturacion */    
    class_Factura cita=new class_Factura();
    ResultSet rst_lista=null;    
    DefaultComboBoxModel modelo=new DefaultComboBoxModel();
    DefaultComboBoxModel modelo1=new DefaultComboBoxModel();
    public frmFacturacion() {
        initComponents();
        PrepararListas();
        this.setSize(420, 440);
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        lblFacturacion = new javax.swing.JLabel();
        lblFechaFactura = new javax.swing.JLabel();
        txtFechaFactura = new javax.swing.JTextField();
        lblHoraFactura = new javax.swing.JLabel();
        txtHoraFactura = new javax.swing.JTextField();
        lblCitaFactura = new javax.swing.JLabel();
        cmbCitaFactura = new javax.swing.JComboBox<>();
        jLabel5 = new javax.swing.JLabel();
        cmbHistorialCFactura = new javax.swing.JComboBox<>();
        lblCostoFactura = new javax.swing.JLabel();
        txtCostoFactura = new javax.swing.JTextField();
        lblDetallesFactura = new javax.swing.JLabel();
        txtDetallesFactura = new javax.swing.JTextField();
        btnAgregarFactura = new javax.swing.JButton();
        btnAtrasFactura = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lblFacturacion.setFont(new java.awt.Font("Times New Roman", 0, 14)); // NOI18N
        lblFacturacion.setForeground(java.awt.Color.red);
        lblFacturacion.setText("FACTURACION");
        getContentPane().add(lblFacturacion, new org.netbeans.lib.awtextra.AbsoluteConstraints(179, 25, -1, -1));

        lblFechaFactura.setFont(new java.awt.Font("Times New Roman", 0, 14)); // NOI18N
        lblFechaFactura.setForeground(java.awt.Color.orange);
        lblFechaFactura.setText("Fecha:");
        getContentPane().add(lblFechaFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(36, 73, -1, -1));

        txtFechaFactura.setFont(new java.awt.Font("Times New Roman", 0, 12)); // NOI18N
        txtFechaFactura.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txtFechaFacturaFocusGained(evt);
            }
        });
        txtFechaFactura.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtFechaFacturaKeyTyped(evt);
            }
        });
        getContentPane().add(txtFechaFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(85, 67, 105, -1));

        lblHoraFactura.setFont(new java.awt.Font("Times New Roman", 0, 14)); // NOI18N
        lblHoraFactura.setForeground(java.awt.Color.orange);
        lblHoraFactura.setText("Hora:");
        getContentPane().add(lblHoraFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(231, 73, -1, -1));

        txtHoraFactura.setFont(new java.awt.Font("Times New Roman", 0, 12)); // NOI18N
        txtHoraFactura.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txtHoraFacturaFocusGained(evt);
            }
        });
        txtHoraFactura.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtHoraFacturaKeyTyped(evt);
            }
        });
        getContentPane().add(txtHoraFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(273, 67, 95, -1));

        lblCitaFactura.setFont(new java.awt.Font("Times New Roman", 0, 14)); // NOI18N
        lblCitaFactura.setForeground(java.awt.Color.orange);
        lblCitaFactura.setText("Cita:");
        getContentPane().add(lblCitaFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(36, 132, -1, -1));

        cmbCitaFactura.setFont(new java.awt.Font("Times New Roman", 0, 12)); // NOI18N
        cmbCitaFactura.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        getContentPane().add(cmbCitaFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(95, 127, 144, -1));

        jLabel5.setFont(new java.awt.Font("Times New Roman", 0, 14)); // NOI18N
        jLabel5.setForeground(java.awt.Color.orange);
        jLabel5.setText("Historial de Cliente:");
        getContentPane().add(jLabel5, new org.netbeans.lib.awtextra.AbsoluteConstraints(36, 182, -1, -1));

        cmbHistorialCFactura.setFont(new java.awt.Font("Times New Roman", 0, 12)); // NOI18N
        cmbHistorialCFactura.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        getContentPane().add(cmbHistorialCFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 180, 129, -1));

        lblCostoFactura.setFont(new java.awt.Font("Times New Roman", 0, 14)); // NOI18N
        lblCostoFactura.setForeground(java.awt.Color.orange);
        lblCostoFactura.setText("Costo:");
        getContentPane().add(lblCostoFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(36, 235, -1, -1));

        txtCostoFactura.setFont(new java.awt.Font("Times New Roman", 0, 12)); // NOI18N
        txtCostoFactura.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtCostoFacturaKeyTyped(evt);
            }
        });
        getContentPane().add(txtCostoFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(95, 229, 93, -1));

        lblDetallesFactura.setFont(new java.awt.Font("Times New Roman", 0, 14)); // NOI18N
        lblDetallesFactura.setForeground(java.awt.Color.orange);
        lblDetallesFactura.setText("Otros Detalles:");
        getContentPane().add(lblDetallesFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(36, 286, -1, -1));

        txtDetallesFactura.setFont(new java.awt.Font("Times New Roman", 0, 12)); // NOI18N
        txtDetallesFactura.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtDetallesFacturaKeyTyped(evt);
            }
        });
        getContentPane().add(txtDetallesFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 280, 224, -1));

        btnAgregarFactura.setFont(new java.awt.Font("Times New Roman", 0, 14)); // NOI18N
        btnAgregarFactura.setForeground(java.awt.Color.green);
        btnAgregarFactura.setText("AGREGAR");
        btnAgregarFactura.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAgregarFacturaActionPerformed(evt);
            }
        });
        getContentPane().add(btnAgregarFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(95, 353, -1, -1));

        btnAtrasFactura.setFont(new java.awt.Font("Times New Roman", 0, 14)); // NOI18N
        btnAtrasFactura.setForeground(java.awt.Color.red);
        btnAtrasFactura.setText("ATRAS");
        btnAtrasFactura.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAtrasFacturaActionPerformed(evt);
            }
        });
        getContentPane().add(btnAtrasFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(246, 353, -1, -1));

        jLabel1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagenes/fundo-azul.png"))); // NOI18N
        getContentPane().add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(-70, -10, -1, -1));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnAtrasFacturaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAtrasFacturaActionPerformed
            frmMenuPrincipal menu=new frmMenuPrincipal();
            this.dispose();
            menu.setVisible(true);
    }//GEN-LAST:event_btnAtrasFacturaActionPerformed

    private void txtCostoFacturaKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtCostoFacturaKeyTyped
        if (!Character.isDigit(evt.getKeyChar())) 
            if (evt.getKeyChar()== '.'){ 
                if (txtCostoFactura.getText().contains(".")) 
                    evt.consume();
                else if (txtCostoFactura.getText().isEmpty())
                    evt.consume();                
            }
        if(txtCostoFactura.getText().length()==2)
            if((txtCostoFactura.getText().charAt(0)=='0')&&(txtCostoFactura.getText().charAt(1)=='0')&&(evt.getKeyChar()=='0'))
                evt.consume();
        if(txtCostoFactura.getText().length()==3)
            if((txtCostoFactura.getText().charAt(0)=='0')&&(txtCostoFactura.getText().charAt(1)=='.')&&(txtCostoFactura.getText().charAt(2)=='0')&&(evt.getKeyChar()=='0'))
                evt.consume();        
        if(txtCostoFactura.getText().length()==4)
            if((txtCostoFactura.getText().charAt(0)=='0')&&(txtCostoFactura.getText().charAt(1)=='0')&&(txtCostoFactura.getText().charAt(2)=='.')&&(txtCostoFactura.getText().charAt(3)=='0')&&(evt.getKeyChar()=='0'))
                evt.consume();
                            
        if (!txtCostoFactura.getText().isEmpty()){
            if(txtCostoFactura.getText().length()==3)
                if(Character.isDigit(txtCostoFactura.getText().charAt(0))&&Character.isDigit(txtCostoFactura.getText().charAt(1))&&Character.isDigit(txtCostoFactura.getText().charAt(2))&&(evt.getKeyChar()!='.'))
                    evt.consume();
            if(txtCostoFactura.getText().length()>=4){
                if(txtCostoFactura.getText().charAt(3)=='.')
                    if (txtCostoFactura.getText().length()== 6)
                        evt.consume();  
            }if(txtCostoFactura.getText().length()>=3){
                if(txtCostoFactura.getText().charAt(2)=='.')
                    if (txtCostoFactura.getText().length()==5)
                        evt.consume();
            }if(txtCostoFactura.getText().length()>=2){
                if(txtCostoFactura.getText().charAt(1)=='.'){
                    if (txtCostoFactura.getText().length()==4)
                        evt.consume();
                }
            }
        } 
    }//GEN-LAST:event_txtCostoFacturaKeyTyped

    private void txtFechaFacturaKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtFechaFacturaKeyTyped
        if ((!Character.isDigit(evt.getKeyChar()))||(txtFechaFactura.getText().length()==10))
        evt.consume();
        if((KeyEvent.VK_BACKSPACE!=evt.getKeyCode())&&(evt.getKeyChar()!='')){
            if((txtFechaFactura.getText().length()==2)||(txtFechaFactura.getText().length()==5))
            txtFechaFactura.setText(txtFechaFactura.getText()+"/");
        }
    }//GEN-LAST:event_txtFechaFacturaKeyTyped

    private void txtFechaFacturaFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtFechaFacturaFocusGained
        if(txtFechaFactura.getText().equals("dd/mm/aaaa"))
        txtFechaFactura.setText("");
    }//GEN-LAST:event_txtFechaFacturaFocusGained

    private void txtHoraFacturaKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtHoraFacturaKeyTyped
        if ((!Character.isDigit(evt.getKeyChar()))||(txtHoraFactura.getText().length()==5))
        evt.consume();
        if((KeyEvent.VK_BACKSPACE!=evt.getKeyCode())&&(evt.getKeyChar()!='')){
            if((txtHoraFactura.getText().length()==2))
            txtHoraFactura.setText(txtHoraFactura.getText()+":");
        }
    }//GEN-LAST:event_txtHoraFacturaKeyTyped

    private void txtHoraFacturaFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtHoraFacturaFocusGained
        if(txtHoraFactura.getText().equals("HH:MM"))
        txtHoraFactura.setText("");
    }//GEN-LAST:event_txtHoraFacturaFocusGained

    private void txtDetallesFacturaKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtDetallesFacturaKeyTyped
        if(txtDetallesFactura.getText().length()==100)
            evt.consume();
    }//GEN-LAST:event_txtDetallesFacturaKeyTyped

    private void btnAgregarFacturaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAgregarFacturaActionPerformed
        if(txtFechaFactura.getText().equals("dd/mm/aaaa")||txtFechaFactura.getText().length()!=10)
            JOptionPane.showMessageDialog(this, "Ingrese una fecha válida");
        else if(txtHoraFactura.getText().equals("HH:MM")||txtHoraFactura.getText().length()==0)
            JOptionPane.showMessageDialog(this, "Ingrese una hora válida");
        else if(txtCostoFactura.getText().isEmpty())
            JOptionPane.showMessageDialog(this, "Ingrese un precio");
        else{
        if(txtDetallesFactura.getText().isEmpty())
            txtDetallesFactura.setText("Ninguno");
        registrar();
        }
    }//GEN-LAST:event_btnAgregarFacturaActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(frmFacturacion.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(frmFacturacion.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(frmFacturacion.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(frmFacturacion.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new frmFacturacion().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnAgregarFactura;
    private javax.swing.JButton btnAtrasFactura;
    private javax.swing.JComboBox<String> cmbCitaFactura;
    private javax.swing.JComboBox<String> cmbHistorialCFactura;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel lblCitaFactura;
    private javax.swing.JLabel lblCostoFactura;
    private javax.swing.JLabel lblDetallesFactura;
    private javax.swing.JLabel lblFacturacion;
    private javax.swing.JLabel lblFechaFactura;
    private javax.swing.JLabel lblHoraFactura;
    private javax.swing.JTextField txtCostoFactura;
    private javax.swing.JTextField txtDetallesFactura;
    private javax.swing.JTextField txtFechaFactura;
    private javax.swing.JTextField txtHoraFactura;
    // End of variables declaration//GEN-END:variables

    private void PrepararListas() {
        reset();
        try{
            modelo.removeAllElements();
            modelo1.removeAllElements();
            rst_lista=cita.ListaCitas();
            while (rst_lista.next()) 
                modelo.addElement(rst_lista.getString(1).toString());
            rst_lista=cita.ListaHistClientes();
            while (rst_lista.next()) 
                modelo1.addElement(rst_lista.getString(1).toString());
        } catch (SQLException ex) {
            JOptionPane.showMessageDialog(rootPane, ex.getMessage(), "Error", 0);
                modelo.addElement("Error");
                modelo1.addElement("Error");
        }
        cmbCitaFactura.setModel(modelo);
        cmbHistorialCFactura.setModel(modelo1);
    }

    private void reset() {
        txtDetallesFactura.setText("");
        txtCostoFactura.setText("");
        txtFechaFactura.setText("dd/mm/aaaa");
        txtHoraFactura.setText("HH:MM");
        cmbCitaFactura.requestFocus();
    }

    private void registrar() {
        String fecha=txtFechaFactura.getText().charAt(6)+""+txtFechaFactura.getText().charAt(7)+""+txtFechaFactura.getText().charAt(8)+""+txtFechaFactura.getText().charAt(9)+"/"+txtFechaFactura.getText().charAt(3)+""+txtFechaFactura.getText().charAt(4)+"/"+txtFechaFactura.getText().charAt(0)+""+txtFechaFactura.getText().charAt(1)+" "+txtHoraFactura.getText();
        cita.insertar(cmbCitaFactura.getSelectedIndex()+1, cmbHistorialCFactura.getSelectedIndex()+1, txtDetallesFactura.getText(), txtCostoFactura.getText(), fecha);
        JOptionPane.showMessageDialog(this, "La transacción se ha completado con éxito");        
        reset();
    }

}
