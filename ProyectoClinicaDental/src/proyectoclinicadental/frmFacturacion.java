/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

package proyectoclinicadental;

import com.sun.glass.events.KeyEvent;
import java.sql.ResultSet;
import java.sql.SQLException;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JOptionPane;

/**
 *
 * @author Javier
 */
public class frmFacturacion extends javax.swing.JFrame {

    class_Factura cita=new class_Factura();
    ResultSet rst_lista=null;    
    DefaultComboBoxModel modelo=new DefaultComboBoxModel();
    DefaultComboBoxModel modelo1=new DefaultComboBoxModel();
    
    /** Creates new form frmFacturacion */
    public frmFacturacion() {
        initComponents();
        PrepararListas();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        lblFacturacion = new javax.swing.JLabel();
        lblFechaFactura = new javax.swing.JLabel();
        txtFechaFactura = new javax.swing.JTextField();
        lblHoraFactura = new javax.swing.JLabel();
        txtHoraFactura = new javax.swing.JTextField();
        lblCitaFactura = new javax.swing.JLabel();
        cmbCitaFactura = new javax.swing.JComboBox<>();
        jLabel5 = new javax.swing.JLabel();
        cmbHistorialCFactura = new javax.swing.JComboBox<>();
        lblCostoFactura = new javax.swing.JLabel();
        txtCostoFactura = new javax.swing.JTextField();
        lblDetallesFactura = new javax.swing.JLabel();
        txtDetallesFactura = new javax.swing.JTextField();
        btnAgregarFactura = new javax.swing.JButton();
        btnAtrasFactura = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        lblFacturacion.setText("FACTURACION");
        getContentPane().add(lblFacturacion, new org.netbeans.lib.awtextra.AbsoluteConstraints(179, 25, -1, -1));

        lblFechaFactura.setText("Fecha:");
        getContentPane().add(lblFechaFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(36, 73, -1, -1));
        getContentPane().add(txtFechaFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(85, 67, 105, -1));

        lblHoraFactura.setText("Hora:");
        getContentPane().add(lblHoraFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(231, 73, -1, -1));
        getContentPane().add(txtHoraFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(273, 67, 95, -1));

        lblCitaFactura.setText("Cita:");
        getContentPane().add(lblCitaFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(36, 132, -1, -1));

        cmbCitaFactura.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        getContentPane().add(cmbCitaFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(95, 127, 144, -1));

        jLabel5.setText("Historial de Cliente:");
        getContentPane().add(jLabel5, new org.netbeans.lib.awtextra.AbsoluteConstraints(36, 182, -1, -1));

        cmbHistorialCFactura.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        getContentPane().add(cmbHistorialCFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 180, 129, -1));

        lblCostoFactura.setText("Costo:");
        getContentPane().add(lblCostoFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(36, 235, -1, -1));
        getContentPane().add(txtCostoFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(95, 229, 93, -1));

        lblDetallesFactura.setText("Otros Detalles:");
        getContentPane().add(lblDetallesFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(36, 286, -1, -1));
        getContentPane().add(txtDetallesFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 280, 224, -1));

        btnAgregarFactura.setText("AGREGAR");
        getContentPane().add(btnAgregarFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(95, 353, -1, -1));

        btnAtrasFactura.setText("ATRAS");
        getContentPane().add(btnAtrasFactura, new org.netbeans.lib.awtextra.AbsoluteConstraints(246, 353, -1, -1));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnAtrasFacturaActionPerformed(java.awt.event.ActionEvent evt) {                                                
            frmMenuPrincipal menu=new frmMenuPrincipal();
            this.dispose();
            menu.setVisible(true);
    }                                               

    private void txtCostoFacturaKeyTyped(java.awt.event.KeyEvent evt) {                                         
        if (!Character.isDigit(evt.getKeyChar())) 
            if (evt.getKeyChar()== '.'){ 
                if (txtCostoFactura.getText().contains(".")) 
                    evt.consume();
                else if (txtCostoFactura.getText().isEmpty())
                    evt.consume();                
            }
        if(txtCostoFactura.getText().length()==2)
            if((txtCostoFactura.getText().charAt(0)=='0')&&(txtCostoFactura.getText().charAt(1)=='0')&&(evt.getKeyChar()=='0'))
                evt.consume();
        if(txtCostoFactura.getText().length()==3)
            if((txtCostoFactura.getText().charAt(0)=='0')&&(txtCostoFactura.getText().charAt(1)=='.')&&(txtCostoFactura.getText().charAt(2)=='0')&&(evt.getKeyChar()=='0'))
                evt.consume();        
        if(txtCostoFactura.getText().length()==4)
            if((txtCostoFactura.getText().charAt(0)=='0')&&(txtCostoFactura.getText().charAt(1)=='0')&&(txtCostoFactura.getText().charAt(2)=='.')&&(txtCostoFactura.getText().charAt(3)=='0')&&(evt.getKeyChar()=='0'))
                evt.consume();
                            
        if (!txtCostoFactura.getText().isEmpty()){
            if(txtCostoFactura.getText().length()==3)
                if(Character.isDigit(txtCostoFactura.getText().charAt(0))&&Character.isDigit(txtCostoFactura.getText().charAt(1))&&Character.isDigit(txtCostoFactura.getText().charAt(2))&&(evt.getKeyChar()!='.'))
                    evt.consume();
            if(txtCostoFactura.getText().length()>=4){
                if(txtCostoFactura.getText().charAt(3)=='.')
                    if (txtCostoFactura.getText().length()== 6)
                        evt.consume();  
            }if(txtCostoFactura.getText().length()>=3){
                if(txtCostoFactura.getText().charAt(2)=='.')
                    if (txtCostoFactura.getText().length()==5)
                        evt.consume();
            }if(txtCostoFactura.getText().length()>=2){
                if(txtCostoFactura.getText().charAt(1)=='.'){
                    if (txtCostoFactura.getText().length()==4)
                        evt.consume();
                }
            }
        } 
    }                                        

    private void txtFechaFacturaKeyTyped(java.awt.event.KeyEvent evt) {                                         
        if ((!Character.isDigit(evt.getKeyChar()))||(txtFechaFactura.getText().length()==10))
        evt.consume();
        if((KeyEvent.VK_BACKSPACE!=evt.getKeyCode())&&(evt.getKeyChar()!='')){
            if((txtFechaFactura.getText().length()==2)||(txtFechaFactura.getText().length()==5))
            txtFechaFactura.setText(txtFechaFactura.getText()+"/");
        }
    }                                        

    private void txtFechaFacturaFocusGained(java.awt.event.FocusEvent evt) {                                            
        if(txtFechaFactura.getText().equals("dd/mm/aaaa"))
        txtFechaFactura.setText("");
    }                                           

    private void txtHoraFacturaKeyTyped(java.awt.event.KeyEvent evt) {                                        
        if ((!Character.isDigit(evt.getKeyChar()))||(txtHoraFactura.getText().length()==5))
        evt.consume();
        if((KeyEvent.VK_BACKSPACE!=evt.getKeyCode())&&(evt.getKeyChar()!='')){
            if((txtHoraFactura.getText().length()==2))
            txtHoraFactura.setText(txtHoraFactura.getText()+":");
        }
    }                                       

    private void txtHoraFacturaFocusGained(java.awt.event.FocusEvent evt) {                                           
        if(txtHoraFactura.getText().equals("HH:MM"))
        txtHoraFactura.setText("");
    }                                          

    private void txtDetallesFacturaKeyTyped(java.awt.event.KeyEvent evt) {                                            
        if(txtDetallesFactura.getText().length()==100)
            evt.consume();
    }                                           

    private void btnAgregarFacturaActionPerformed(java.awt.event.ActionEvent evt) {                                                  
        if(txtFechaFactura.getText().equals("dd/mm/aaaa")||txtFechaFactura.getText().length()!=10)
            JOptionPane.showMessageDialog(this, "Ingrese una fecha válida");
        else if(txtHoraFactura.getText().equals("HH:MM")||txtHoraFactura.getText().length()==0)
            JOptionPane.showMessageDialog(this, "Ingrese una hora válida");
        else if(txtCostoFactura.getText().isEmpty())
            JOptionPane.showMessageDialog(this, "Ingrese un precio");
        else{
        if(txtDetallesFactura.getText().isEmpty())
            txtDetallesFactura.setText("Ninguno");
        registrar();
        }
    }
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(frmFacturacion.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(frmFacturacion.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(frmFacturacion.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(frmFacturacion.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new frmFacturacion().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnAgregarFactura;
    private javax.swing.JButton btnAtrasFactura;
    private javax.swing.JComboBox<String> cmbCitaFactura;
    private javax.swing.JComboBox<String> cmbHistorialCFactura;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel lblCitaFactura;
    private javax.swing.JLabel lblCostoFactura;
    private javax.swing.JLabel lblDetallesFactura;
    private javax.swing.JLabel lblFacturacion;
    private javax.swing.JLabel lblFechaFactura;
    private javax.swing.JLabel lblHoraFactura;
    private javax.swing.JTextField txtCostoFactura;
    private javax.swing.JTextField txtDetallesFactura;
    private javax.swing.JTextField txtFechaFactura;
    private javax.swing.JTextField txtHoraFactura;
    // End of variables declaration//GEN-END:variables

    private void PrepararListas() {
        reset();
        try{
            modelo.removeAllElements();
            modelo1.removeAllElements();
            rst_lista=cita.ListaCitas();
            while (rst_lista.next()) 
                modelo.addElement(rst_lista.getString(1).toString());
            rst_lista=cita.ListaHistClientes();
            while (rst_lista.next()) 
                modelo1.addElement(rst_lista.getString(1).toString());
        } catch (SQLException ex) {
            JOptionPane.showMessageDialog(rootPane, ex.getMessage(), "Error", 0);
                modelo.addElement("Error");
                modelo1.addElement("Error");
        }
        cmbCitaFactura.setModel(modelo);
        cmbHistorialCFactura.setModel(modelo1);
    }

    private void reset() {
        txtDetallesFactura.setText("");
        txtCostoFactura.setText("");
        txtFechaFactura.setText("dd/mm/aaaa");
        txtHoraFactura.setText("HH:MM");
        cmbCitaFactura.requestFocus();
    }

    private void registrar() {
        String fecha=txtFechaFactura.getText().charAt(6)+""+txtFechaFactura.getText().charAt(7)+""+txtFechaFactura.getText().charAt(8)+""+txtFechaFactura.getText().charAt(9)+"/"+txtFechaFactura.getText().charAt(3)+""+txtFechaFactura.getText().charAt(4)+"/"+txtFechaFactura.getText().charAt(0)+""+txtFechaFactura.getText().charAt(1)+" "+txtHoraFactura.getText();
        cita.insertar(cmbCitaFactura.getSelectedIndex()+1, cmbHistorialCFactura.getSelectedIndex()+1, txtDetallesFactura.getText(), txtCostoFactura.getText(), fecha);
        JOptionPane.showMessageDialog(this, "La transacción se ha completado con éxito");        
        reset();
    }
    
}
